<!DOCTYPE html>
<html>
    <head>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/pixi.js/5.1.3/pixi.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/pixi-viewport@4.11.1/dist/viewport.js"></script>
    </head>
    <body></body>
    <style>
        * {
            margin: 0;
            padding: 0;
        } 
        body {
            margin: none !important;
        }
    </style>
    <script>
        const WIDTH = 750;
        const HEIGHT = 750;
        const CELL_WIDTH = 25;
        const CELL_HEIGHT = 25;
        const WORLD_WIDTH = 5000;
        const WORLD_HEIGHT = 5000;
        const app = new PIXI.Application({
            height: HEIGHT,
            width: WIDTH,
        });
        const viewport = new Viewport.Viewport({
            screenWidth: WIDTH,
            screenHeight: HEIGHT,
            worldWidth: WORLD_WIDTH,
            worldHeight: WORLD_HEIGHT,
            interaction: app.renderer.plugins.interaction
        });

        app.stage.addChild(viewport)
        viewport
            .drag()
            .pinch();

        viewport.position.x = -WORLD_WIDTH / 2
        viewport.position.y = -WORLD_HEIGHT / 2;

        viewport.on("clicked", (event) => {
            const xIndex = Math.floor(event.world.x / CELL_WIDTH);
            const yIndex = Math.floor(event.world.y / CELL_HEIGHT);            
            const tile = tiles[yIndex][xIndex];

            tile.isAlive = !tile.isAlive;
            if(tile.isAlive){
                tile.graphics.beginFill(0xFFFF00)
                tile.graphics.drawRect(tile.x, tile.y, CELL_WIDTH, CELL_HEIGHT);
            } else {
                tile.graphics.clear();
            }
            const neighbors = getNeighbors(tile);
            neighbors.forEach((neighbor) => {
                // debugger;
                console.log(neighbor)
                neighbor.graphics.beginFill(0x0000FF)
                neighbor.graphics.drawRect(neighbor.x, neighbor.y, CELL_WIDTH, CELL_HEIGHT);
            });
        })


        const grid = new PIXI.Graphics();
        const tiles = []
        grid.lineStyle(1, 0xFFFFFF);
        
        for(let y = 0; y < WORLD_HEIGHT; y += CELL_HEIGHT){
            grid.moveTo(0, y)
                .lineTo(WORLD_WIDTH, y);
        }

        for (let x = 0; x < WORLD_WIDTH; x += CELL_WIDTH){
            grid.moveTo(x, 0)
                .lineTo(x, WORLD_HEIGHT);
        }

        for (let y = 0; y < WORLD_HEIGHT; y += CELL_HEIGHT){
            const row = []
            for(let x = 0; x < WORLD_WIDTH; x += CELL_WIDTH){
                const graphics = new PIXI.Graphics();
                row.push({
                    y,
                    x,
                    graphics,
                    isAlive: false,
                });
                viewport.addChild(graphics)
            }
            tiles.push(row)
        }

        viewport.addChild(grid);

        document.body.appendChild(app.view);

        const getNeighbors = (tile) => {
            const neighbors = [];
            const x = Math.floor(tile.x / CELL_WIDTH);
            const y = Math.floor(tile.y / CELL_HEIGHT);
            neighbors.push(tiles[y - 1][x - 1]);
            neighbors.push(tiles[y - 1][x]);
            neighbors.push(tiles[y - 1][x + 1]);
            neighbors.push(tiles[y][x - 1]);
            neighbors.push(tiles[y][x + 1]);
            neighbors.push(tiles[y + 1][x - 1]);
            neighbors.push(tiles[y + 1][x]);
            neighbors.push(tiles[y + 1][x + 1]);
            return neighbors;
        }




    </script>
</html>